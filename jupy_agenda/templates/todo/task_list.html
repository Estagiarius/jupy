{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<style>
    .task-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    .task-table th, .task-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    .task-table th {
        background-color: #f2f2f2;
    }
    .task-actions a, .task-actions button {
        margin-right: 5px;
        text-decoration: none;
    }
    .task-actions form {
        display: inline; /* Keep buttons on the same line */
    }
    .filters {
        margin-bottom: 20px;
    }
    .filters label, .filters select, .filters input {
        margin-right: 10px;
    }
    .completed-task td {
        text-decoration: line-through;
        color: #888;
    }
    .priority-High { background-color: #ffdddd; } /* Light red */
    .priority-Medium { background-color: #ffffcc; } /* Light yellow */
    .priority-Low { background-color: #ddffdd; } /* Light green */
</style>

<h2>{{ title }}</h2>

<div class="filters">
    <form method="GET" action="{{ url_for('todo.list_tasks') }}">
        <label for="status_filter">Filter by Status:</label>
        <select name="status" id="status_filter" onchange="this.form.submit()">
            <option value="" {% if not current_status_filter %}selected{% endif %}>All</option>
            <option value="pending" {% if current_status_filter == 'pending' %}selected{% endif %}>Pending</option>
            <option value="completed" {% if current_status_filter == 'completed' %}selected{% endif %}>Completed</option>
        </select>

        <label for="sort_by">Sort by:</label>
        <select name="sort_by" id="sort_by" onchange="this.form.submit()">
            <option value="priority" {% if current_sort_by == 'priority' %}selected{% endif %}>Priority</option>
            <option value="due_date" {% if current_sort_by == 'due_date' %}selected{% endif %}>Due Date</option>
            <option value="created_at" {% if current_sort_by == 'created_at' %}selected{% endif %}>Creation Date</option>
        </select>
        <!-- Hidden submit button, form submitted by onchange -->
    </form>
</div>

<a href="{{ url_for('todo.add_task') }}" class="btn btn-primary">Add New Task</a>

{% if tasks %}
<div class="table-wrapper"> <!-- Added table-wrapper -->
<table class="task-table">
    <thead>
        <tr>
            <th>Description</th>
            <th>Due Date</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr class="{{ 'completed-task' if task.status == 'completed' else '' }} priority-{{ task.priority_display }}">
            <td>{{ task.description }}</td>
            <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else 'N/A' }}</td>
            <td>{{ task.priority_display }}</td>
            <td>{{ task.status.capitalize() }}</td>
            <td class="task-actions">
                <a href="{{ url_for('todo.edit_task', task_id=task.id) }}" class="btn btn-sm btn-info">Edit</a>
                
                <form method="POST" action="{{ url_for('todo.update_task_status', task_id=task.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-sm {{ 'btn-warning' if task.status == 'completed' else 'btn-success' }}">
                        {{ 'Mark Pending' if task.status == 'completed' else 'Mark Complete' }}
                    </button>
                </form>

                <form method="POST" action="{{ url_for('todo.delete_task', task_id=task.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div> <!-- Close table-wrapper -->
{% else %}
<p>No tasks found. Why not <a href="{{ url_for('todo.add_task') }}">add one</a>?</p>
{% endif %}

{% endblock %}
